# Оптимизация изображений

## Проблема
Изображение `/brand/01.webp` имело размер 1873x1365 пикселей (43.8 КБ), но отображалось в контейнере 640x466 пикселей. Это приводило к загрузке избыточных данных и снижению производительности.

## Решение

### 1. Создан компонент `ResponsiveImage`
Новый компонент автоматически оптимизирует размеры изображений на основе:
- Предустановленных конфигураций для популярных изображений
- Размеров контейнера
- Адаптивных breakpoints

```tsx
import ResponsiveImage from '@atoms/ResponsiveImage';

<ResponsiveImage
  src="/brand/01.webp"
  alt="Описание изображения"
  containerWidth={640}
  containerHeight={466}
  priority={false}
  objectFit="contain"
/>
```

### 2. Библиотека оптимизации `image-optimizer.ts`
Содержит:
- Предустановленные конфигурации для изображений
- Функции расчета оптимальных размеров
- Генерацию responsive sizes атрибутов
- Автоматический выбор качества изображения

### 3. Обновленная конфигурация Next.js
- Оптимизированные размеры устройств: `[320, 420, 640, 750, 828, 1080, 1200, 1920]`
- Дополнительные размеры изображений: включен размер `466` и `640`
- Увеличенное время кэширования: 1 год
- Поддержка SVG с безопасной CSP

### 4. Middleware оптимизация
Предзагрузка оптимизированной версии изображения:
```
</_next/image?url=%2Fbrand%2F01.webp&w=640&q=85>; rel=preload; as=image
```

## Результаты оптимизации

### До оптимизации:
- Размер файла: 43.8 КБ
- Размер изображения: 1873x1365
- Размер контейнера: 640x466
- Избыточные данные: ~65%

### После оптимизации:
- Размер файла: ~15-20 КБ (ожидаемо)
- Размер изображения: 640x466
- Размер контейнера: 640x466
- Избыточные данные: 0%

## Использование

### Для новых изображений:
1. Добавьте конфигурацию в `IMAGE_OPTIMIZATIONS` в `image-optimizer.ts`
2. Используйте компонент `ResponsiveImage` вместо обычного `<img>` или `<Image>`

### Для существующих изображений:
1. Замените `<img>` и `<Image>` на `ResponsiveImage`
2. Укажите `containerWidth` и `containerHeight` если известны
3. Выберите подходящий `objectFit` (`contain`, `cover`, `fill`)

## Предустановленные конфигурации

```typescript
'/brand/01.webp': {
  dimensions: { width: 640, height: 466 },
  sizes: '(max-width: 640px) 100vw, (max-width: 1024px) 640px, 800px',
  quality: 85
}

'/brand/Logo.webp': {
  dimensions: { width: 200, height: 60 },
  sizes: '(max-width: 768px) 150px, 200px',
  priority: true,
  quality: 95
}
```

## Breakpoint presets

- **hero**: Полноэкранные изображения
- **card**: Изображения в карточках
- **logo**: Логотипы и иконки
- **thumbnail**: Миниатюры

## Автоматическое качество

- **Критические изображения** (priority=true): 95%
- **Брендовые изображения** (/brand/, /hero/): 85%
- **Декоративные изображения**: 75%

## Мониторинг

Используйте скрипт производительности для отслеживания улучшений:
```bash
npm run perf
```

## Рекомендации

1. Всегда указывайте `alt` атрибут для доступности
2. Используйте `priority={true}` только для критических изображений above-the-fold
3. Выбирайте подходящий `objectFit` в зависимости от контекста
4. Тестируйте на разных размерах экрана
